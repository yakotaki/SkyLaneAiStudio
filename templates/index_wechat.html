{% extends "base.html" %}
{% block title %}SkyLane AI Studio{% endblock %}

{% block content %}
<div class="p-3 rounded-4 border bg-body-tertiary hero-card">
    <div class="fw-bold fs-4 mb-1">{{ "销售 · 管理 · 增长" if lang=="zh" else "Sell. Manage. Grow." }}</div>
    <div class="text-secondary mb-2">
      {{ "支持手机与电脑端访问；支持中文/英文/多语言。" if lang=="zh" else "Mobile + PC ready. CN/EN/multi-language support." }}
    </div>
    <div class="small">
      <div>{{ support_policy.hours }}</div>
      <div class="text-secondary">{{ support_policy.missed_calls }}</div>
    </div>
  </div>

  <div class="pt-4" id="addons">
    <div class="fw-bold mb-2">{{ "增值选项" if lang=="zh" else "Add-ons" }}</div>
    {% for a in addons %}
      <div class="p-3 rounded-4 border bg-white mb-2">
        <div class="d-flex justify-content-between">
          <div class="fw-semibold">{{ a.display_name }}</div>
          <div class="badge text-bg-light border">+{{ a.price }}</div>
        </div>
        <div class="text-secondary small mt-1">{{ a.display_desc }}</div>
      </div>
    {% endfor %}
    <!-- <div class="text-secondary small mt-2">
      {{ "在线聊天/WhatsApp 接入包含网页收件箱面板（浏览器回复），适合卖家在中国使用。" if lang=="zh"
         else "Online Chat/WhatsApp add-on includes a web inbox dashboard (reply in browser), suitable for sellers in China." }}
    </div> -->
  </div>

  <div class="pt-4" id="contact">
    <div class="fw-bold mb-2">{{ "联系与报价" if lang=="zh" else "Contact & Quote" }}</div>
    <form method="post" action="{{ url_for('contact_submit') }}" class="p-3 rounded-4 border bg-body-tertiary hero-card">
      <input type="hidden" name="lang" value="{{ lang }}"/>

      <label class="form-label">{{ "姓名" if lang=="zh" else "Name" }}</label>
      <input class="form-control mb-2" name="name" required>

      <label class="form-label">{{ "公司（可选）" if lang=="zh" else "Company (optional)" }}</label>
      <input class="form-control mb-2" name="company">

      <label class="form-label">{{ "邮箱（可选）" if lang=="zh" else "Email (optional)" }}</label>
      <input class="form-control mb-2" name="email" type="email">

      <label class="form-label">{{ "微信/电话（可选）" if lang=="zh" else "WeChat / Phone (optional)" }}</label>
      <input class="form-control mb-2" name="wechat_or_phone">

      <label class="form-label">{{ "需求说明" if lang=="zh" else "Message" }}</label>
      <textarea class="form-control mb-3" name="message" rows="4"></textarea>

      <button class="btn btn-primary w-100" type="submit">{{ "提交" if lang=="zh" else "Submit" }}</button>

      <div class="text-secondary small mt-2">
        {{ "我们会在 1 个工作日内回复。" if lang=="zh" else "We will reply within 1 business day." }}
      </div>
    </form>
  </div>


  <!-- Demos -->
  <section id="demos" class="pt-4">
    <h2 class="h5 fw-bold mb-2">{{ "演示站" if lang=="zh" else "Demos" }}</h2>
    <div class="row g-3">
      {% for p in projects %}
      <div class="col-12">
        <a class="d-block p-3 rounded-4 border bg-white text-decoration-none" href="{{ p.url }}" target="_blank">
          <div class="fw-semibold">{{ p.name }}</div>
          <div class="text-secondary small">{{ p.desc }}</div>
        </a>
      </div>
      {% endfor %}
    </div>
  </section>

  <!-- Packages -->
  <section id="packages" class="pt-4">
    <h2 class="h5 fw-bold mb-2">{{ "套餐" if lang=="zh" else "Packages" }}</h2>
    <div class="row g-3">
      {% for pkg in packages %}
      <div class="col-12">
        <div class="p-3 rounded-4 border bg-white">
          <div class="d-flex justify-content-between align-items-start">
            <div class="fw-semibold">{{ pkg.display_name }}</div>
            <div class="badge text-bg-light border">{{ pkg.display_price }}</div>
          </div>
          <div class="text-secondary small mt-1">{{ pkg.display_delivery }}</div>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <!-- Calculator -->
  <section id="calculator" class="pt-4">
    <h2 class="h5 fw-bold mb-2">{{ "费用估算" if lang=="zh" else "Cost Estimator" }}</h2>
    <div class="p-3 rounded-4 border bg-white">
      <label class="form-label fw-semibold" for="calcPackage">{{ "选择套餐" if lang=="zh" else "Select package" }}</label>
      <select class="form-select mb-3" id="calcPackage">
        {% for pkg in packages %}
          <option value="{{ pkg.id }}" data-price="{{ pkg.display_price }}">{{ pkg.display_name }} ({{ pkg.display_price }})</option>
        {% endfor %}
      </select>


          <!-- Language tier -->
          <div class="fw-semibold mt-3 mb-2">{{ "语言等级" if lang=="zh" else "Language tier" }}</div>
          <div class="border rounded-3 p-3 bg-light-subtle mb-3">
            {% for t in language_tiers %}
            <label class="d-flex gap-2 align-items-start mb-2">
              <input class="form-check-input mt-1" type="radio" name="language_tier" value="{{ t.id }}"
                     {% if t.id == "starter" %}checked{% endif %} data-add="{{ t.add_price }}">
              <div>
                <div class="fw-semibold">{{ t.display_name }}</div>
                <div class="small text-secondary">
                  {% if lang=="zh" %}
                    最多 {{ t.max_lang }} 种语言 · +¥{{ t.add_price }}
                  {% else %}
                    Up to {{ t.max_lang }} languages · +¥{{ t.add_price }}
                  {% endif %}
                </div>
              </div>
            </label>
            {% endfor %}
            <div class="alert alert-warning small mt-2 mb-0">{{ banking_service_note }}</div>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="addonDomain" data-fee="150">
            <label class="form-check-label" for="addonDomain">{{ "网站地址 (+150元 / year)" if lang=="zh" else "Website address (+¥150 / year)" }}</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="addonSeo" data-fee="250">
            <label class="form-check-label" for="addonSeo">{{ "搜索引擎 SEO 基础设置 (+250元)" if lang=="zh" else "Search Engine SEO Setup (+¥1,500)" }}</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="addonCopy" data-fee="200">
            <label class="form-check-label" for="addonCopy">{{ "专业语言文案撰写 (+200元)" if lang=="zh" else "Professional Language Copywriting (+¥2,000)" }}</label>
          </div>
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="addonChat" data-fee="200">
            <label class="form-check-label" for="addonChat">{{ "在线聊天 / WhatsApp 接入 (+200元)" if lang=="zh" else "Online Chat / WhatsApp Integration (+¥1,000)" }}</label>
          </div>


      <div class="fw-semibold">{{ "估算合计" if lang=="zh" else "Estimated total" }}：</div>
      <div class="h3 fw-bold mb-0" id="calcTotal">—</div>
      <div class="text-secondary small mt-2">
        {{ "仅供参考，最终以范围为准。" if lang=="zh" else "Estimate for reference only. Final quote depends on scope." }}
      </div>
    </div>

    <script>
      (function(){
        function parsePrice(s){
          if(!s) return 0;
          var n = String(s).replace(/,/g,'').replace(/[^\d.]/g,'');
          return parseFloat(n || '0');
        }
        function recalc(){
          var sel = document.getElementById('calcPackage');
          if(!sel) return;
          var baseStr = sel.options[sel.selectedIndex]?.dataset?.price || sel.options[sel.selectedIndex]?.textContent || '';
          var base = parsePrice(baseStr);
          var addons = 0;
          document.querySelectorAll('#calculator [data-fee]').forEach(function(el){
            if(el.checked) addons += parseFloat(el.dataset.fee || '0');
          });
          var tier = 0;
        var tierEl = document.querySelector('input[name="language_tier"]:checked');
        if(tierEl){ tier = parsePrice(tierEl.getAttribute('data-add')); }
        var total = base + addons + tier;
          var out = document.getElementById('calcTotal');
          if(out){ out.textContent = '¥' + total.toLocaleString('en-US'); }
        }
        document.addEventListener('change', function(e){
          if(e.target && (e.target.id === 'calcPackage' || e.target.matches('#calculator [data-fee]') || e.target.matches('input[name="language_tier"]'))){ recalc(); }
        });
        document.addEventListener('DOMContentLoaded', recalc);
      })();
    </script>
  </section>

</div>
{% endblock %}